<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Aper√ßu de la recette</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/post-recipe.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .preview-container { max-width: 700px; margin: 40px auto; background: #fff; border-radius: 16px; box-shadow: 0 8px 40px #0002; padding: 32px 24px; }
    .preview-actions { display: flex; gap: 16px; justify-content: center; margin-top: 32px; }
  </style>
</head>
<body>
  <div class="preview-container">
    <div id="previewContent"></div>
    <div class="preview-actions">
  <button id="backBtn" class="btn btn-outline"><i class="fas fa-arrow-left"></i> Retour</button>
  <button id="shareRecipeBtn" class="btn btn-primary"><i class="fas fa-share"></i> Partager la recette</button>
  <button id="printRecipeBtn" class="btn btn-outline"><i class="fas fa-print"></i> Imprimer la recette</button>
  <button id="pdfRecipeBtn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Exporter en PDF</button>
    </div>
  </div>
  <script>
    // R√©cup√©rer les donn√©es du formulaire depuis sessionStorage
    const previewData = JSON.parse(sessionStorage.getItem('recipePreview') || '{}');
    let html = '';
    if (previewData.images && previewData.images.length > 0) {
      html += '<div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:18px;">';
      previewData.images.forEach(img => {
        html += `<img src="${img.src}" alt="Image recette" style="width:110px;height:80px;object-fit:cover;border-radius:8px;box-shadow:0 2px 8px #0001;">`;
      });
      html += '</div>';
    }
    html += `<h2 style=\"color:#e74c3c;margin-bottom:8px;\">${previewData.title || ''}</h2>`;
    html += '<div style="color:#555;font-size:1rem;margin-bottom:12px;">';
    if (previewData.chefName) html += `<b>Par :</b> ${previewData.chefName} &nbsp;`;
    if (previewData.category) html += `<b>Cat√©gorie :</b> ${previewData.category} &nbsp;`;
    if (previewData.prepTime) html += `<b>Pr√©paration :</b> ${previewData.prepTime} &nbsp;`;
    if (previewData.cookTime) html += `<b>Cuisson :</b> ${previewData.cookTime} &nbsp;`;
    if (previewData.servings) html += `<b>Portions :</b> ${previewData.servings}`;
    html += '</div>';
    html += '<h3 style="color:#2c3e50;margin-top:18px;">üìù Ingr√©dients</h3>';
    html += '<ul style="margin-bottom:18px;">';
    (previewData.ingredients || '').split(/\n|\r/).filter(l=>l.trim()).forEach(ing => {
      html += `<li>${ing.replace(/^[-‚Ä¢\d.\s]+/,'')}</li>`;
    });
    html += '</ul>';
    html += '<h3 style="color:#e74c3c;margin-top:18px;">üç≥ Instructions</h3>';
    html += '<ol style="margin-bottom:18px;">';
    (previewData.instructions || '').split(/\n|\r/).filter(l=>l.trim()).forEach((step,i) => {
      html += `<li>${step.replace(/^[-‚Ä¢\d.\s]+/,'')}</li>`;
    });
    html += '</ol>';
    if (previewData.history && previewData.history.trim()) {
      html += '<h4 style="color:#2c3e50;margin-top:18px;">üìñ Histoire & contexte</h4>';
      html += `<div style="margin-bottom:18px;">${previewData.history.replace(/\n/g,'<br>')}</div>`;
    }
    if (previewData.tips && previewData.tips.trim()) {
      html += '<h4 style="color:#e67e22;margin-top:18px;">üí° Conseils du chef</h4>';
      html += `<div style="margin-bottom:18px;">${previewData.tips.replace(/\n/g,'<br>')}</div>`;
    }
    document.getElementById('previewContent').innerHTML = html;
    // Bouton retour
    document.getElementById('backBtn').onclick = function() {
      window.close();
      if (window.opener) {
        try { window.opener.focus(); } catch(e){}
      }
    };
    // Bouton imprimer
    document.getElementById('printRecipeBtn').onclick = function() {
      const clone = document.getElementById('previewContent').cloneNode(true);
      const btns = clone.querySelectorAll('button');
      btns.forEach(b => b.remove());
      const printWindow = window.open('', '', 'width=800,height=600');
      printWindow.document.write('<html><head><title>Imprimer la recette</title>');
      printWindow.document.write('<link rel="stylesheet" href="css/post-recipe.css">');
      printWindow.document.write('</head><body>' + clone.innerHTML + '</body></html>');
      printWindow.document.close();
      setTimeout(() => printWindow.print(), 300);
    };
    // Bouton partager
    document.getElementById('shareRecipeBtn').onclick = async function() {
      try {
        await navigator.clipboard.writeText(document.getElementById('previewContent').innerText);
        alert('Recette copi√©e dans le presse-papier !');
      } catch (e) {
        alert('Impossible de copier la recette');
      }
    };
    // Bouton PDF
    document.getElementById('pdfRecipeBtn').onclick = function() {
      const content = document.getElementById('previewContent').innerHTML;
      const win = window.open('', '', 'width=800,height=600');
      win.document.write('<html><head><title>Recette PDF</title>');
      win.document.write('<link rel="stylesheet" href="css/post-recipe.css">');
      win.document.write('<style>body{font-family:sans-serif;padding:32px;} h2,h3,h4{color:#e74c3c;} ul,ol{margin-left:20px;} img{max-width:100%;height:auto;}</style>');
      win.document.write('</head><body>' + content + '</body></html>');
      win.document.close();
      setTimeout(() => win.print(), 400);
    };
  </script>
</body>
</html>
